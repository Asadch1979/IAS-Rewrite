@{
    ViewData["Title"] = "AIS Post Compliance";
    Layout = "_Layout";
}
<script type="text/javascript">
    var postComplianceData = [];
    function getZoneBranches() {
        destroyDatatable('manageObsPanel');
        $('#branchSelectField').empty();
        if ($('#zoneSelectField option:selected').val() != 0) {
            $.ajax({
                url: g_asiBaseURL + "/ApiCalls/get_zone_Branches",
                type: "POST",
                data: {
                    'ZONEID': $('#zoneSelectField option:selected').val()
                },
                cache: false,
                success: function (data) {
                    $('#branchSelectField').append('<option value="0" id="0">--Select Branch--</option>');
                    $.each(data, function (i, v) {
                        $('#branchSelectField').append('<option value="' + v.branchid + '" id="' + v.branchid + '">' + v.branchname + '</option>');
                    })
                },
                dataType: "json",
            });
        }
    }
    function getPostCompliance() {
        destroyDatatable('manageObsPanel');
        $('#manageObsPanel tbody').empty();
        if ($('#branchSelectField option:selected').val() != 0) {
            $.ajax({
                url: g_asiBaseURL + "/ApiCalls/get_ais_post_compliance_details",
                type: "POST",
                data: {
                    'ENT': $('#branchSelectField option:selected').val()
                },
                cache: false,
                success: function (data) {
                    postComplianceData = data;
                    $.each(data, function (i, v) {
                        $('#manageObsPanel tbody').append('<tr data-index="' + i + '"><td>' + (++i) + '</td><td>' + v.c_NAME + '</td><td>' + v.audit_PERIOD + '</td><td>' + v.para_NO + '</td><td>' + v.gist_OF_PARAS + '</td><td><button class="btn btn-sm btn-primary" onclick="openUpdateModal(' + (i-1) + ');">Update</button></td></tr>');
                    });
                    initializeDataTable('manageObsPanel');
                },
                dataType: "json",
            });
        }
    }
    function openUpdateModal(index) {
        var d = postComplianceData[index];
        $('#rowIndex').val(index);
        for (var key in d) {
            if ($('#upd_' + key).length)
                $('#upd_' + key).val(d[key]);
        }
        $('#updateModal').modal('show');
    }
    function submitUpdate() {
        var idx = $('#rowIndex').val();
        var payload = {};
        $('#updateModal input').each(function(){
            payload[$(this).attr('name')] = $(this).val();
        });
        $.ajax({
            url: g_asiBaseURL + "/ApiCalls/update_ais_post_compliance",
            type: "POST",
            data: payload,
            cache: false,
            success: function (resp) {
                alert(resp.Message);
                $('#updateModal').modal('hide');
                getPostCompliance();
            },
            dataType: "json",
        });
    }
</script>
<h3 style=" display:block;color: #45c545;" class="mt-3">@ViewData["Title"]</h3>
<div class="row col-md-12 mt-3">
    <div class="col-md-2">
        <label><b>Reporting Office:</b></label>
    </div>
    <div class="col-md-10">
        <select id="zoneSelectField" onchange="getZoneBranches()" class="form-control form-select">
            <option value="0" id="0">--Select Reporting Office--</option>
            @{
                if (ViewData["ZonesList"] != null)
                {
                    foreach (var item in (dynamic)(ViewData["ZonesList"]))
                    {
                        <option value="@item.ZONEID" id="@item.ZONEID">@item.ZONENAME</option>
                    }
                }
            }
        </select>
    </div>
</div>
<div class="row col-md-12 mt-3">
    <div class="col-md-2">
        <label><b>Entity:</b></label>
    </div>
    <div class="col-md-10">
        <select id="branchSelectField" onchange="getPostCompliance();" class="form-control form-select">
            <option value="0" id="0">--Select Entity--</option>
        </select>
    </div>
</div>
<div class="row col-md-12 mt-4">
    <table id="manageObsPanel" class="table table-hover table-bordered table-hover mt-3 table-striped">
        <thead style="background-color: #19875478 !important; ">
            <tr>
                <th class="col-md-1">Sr. No.</th>
                <th class="col-md-2">Entity Name</th>
                <th class="col-md-1">Audit Period</th>
                <th class="col-md-1">Para Number</th>
                <th class="col-md-6">Heading</th>
                <th class="col-md-1">Action</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>
<div id="updateModal" class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document" style="min-width:90% !important;">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">Update Post Compliance</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="rowIndex" />
                <div class="row">
                    <div class="col-md-4" *ngFor="let f of postComplianceData">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3"><label>COM_ID</label><input id="upd_COM_ID" name="COM_ID" class="form-control" /></div>
                    <div class="col-md-3"><label>OLD_PARA_ID</label><input id="upd_OLD_PARA_ID" name="OLD_PARA_ID" class="form-control" /></div>
                    <div class="col-md-3"><label>NEW_PARA_ID</label><input id="upd_NEW_PARA_ID" name="NEW_PARA_ID" class="form-control" /></div>
                    <div class="col-md-3"><label>AUDIT_PERIOD</label><input id="upd_AUDIT_PERIOD" name="AUDIT_PERIOD" class="form-control" /></div>
                    <div class="col-md-3"><label>ENTITY_ID</label><input id="upd_ENTITY_ID" name="ENTITY_ID" class="form-control" /></div>
                    <div class="col-md-3"><label>ENTITY_CODE</label><input id="upd_ENTITY_CODE" name="ENTITY_CODE" class="form-control" /></div>
                    <div class="col-md-3"><label>AUDITED_BY</label><input id="upd_AUDITED_BY" name="AUDITED_BY" class="form-control" /></div>
                    <div class="col-md-3"><label>ENTITY_TYPE_ID</label><input id="upd_ENTITY_TYPE_ID" name="ENTITY_TYPE_ID" class="form-control" /></div>
                    <div class="col-md-3"><label>COM_CYCLE</label><input id="upd_COM_CYCLE" name="COM_CYCLE" class="form-control" /></div>
                    <div class="col-md-3"><label>COM_STATUS</label><input id="upd_COM_STATUS" name="COM_STATUS" class="form-control" /></div>
                    <div class="col-md-3"><label>COM_STAGE</label><input id="upd_COM_STAGE" name="COM_STAGE" class="form-control" /></div>
                    <div class="col-md-3"><label>PARA_STATUS</label><input id="upd_PARA_STATUS" name="PARA_STATUS" class="form-control" /></div>
                    <div class="col-md-3"><label>PARA_NO</label><input id="upd_PARA_NO" name="PARA_NO" class="form-control" /></div>
                    <div class="col-md-3"><label>GIST_OF_PARAS</label><input id="upd_GIST_OF_PARAS" name="GIST_OF_PARAS" class="form-control" /></div>
                    <div class="col-md-3"><label>SETTELED_ON</label><input id="upd_SETTELED_ON" name="SETTELED_ON" class="form-control" /></div>
                    <div class="col-md-3"><label>SETTELED_BY</label><input id="upd_SETTELED_BY" name="SETTELED_BY" class="form-control" /></div>
                    <div class="col-md-3"><label>IND</label><input id="upd_IND" name="IND" class="form-control" /></div>
                    <div class="col-md-3"><label>PARA_ADDED_ON</label><input id="upd_PARA_ADDED_ON" name="PARA_ADDED_ON" class="form-control" /></div>
                    <div class="col-md-3"><label>CAU_STATUS</label><input id="upd_CAU_STATUS" name="CAU_STATUS" class="form-control" /></div>
                    <div class="col-md-3"><label>CAU_ASSIGNED_ENT_ID</label><input id="upd_CAU_ASSIGNED_ENT_ID" name="CAU_ASSIGNED_ENT_ID" class="form-control" /></div>
                    <div class="col-md-3"><label>BR_RESPONSE_BY</label><input id="upd_BR_RESPONSE_BY" name="BR_RESPONSE_BY" class="form-control" /></div>
                    <div class="col-md-3"><label>BR_RESPONSE_ON</label><input id="upd_BR_RESPONSE_ON" name="BR_RESPONSE_ON" class="form-control" /></div>
                    <div class="col-md-3"><label>CAU_ASSIGNED_BY</label><input id="upd_CAU_ASSIGNED_BY" name="CAU_ASSIGNED_BY" class="form-control" /></div>
                    <div class="col-md-3"><label>CAU_ASSIGNED_ON</label><input id="upd_CAU_ASSIGNED_ON" name="CAU_ASSIGNED_ON" class="form-control" /></div>
                    <div class="col-md-3"><label>SETTLEMENT_COM_REVIEWED_BY</label><input id="upd_SETTLEMENT_COM_REVIEWED_BY" name="SETTLEMENT_COM_REVIEWED_BY" class="form-control" /></div>
                    <div class="col-md-3"><label>SETTLEMENT_COM_REVIEWED_ON</label><input id="upd_SETTLEMENT_COM_REVIEWED_ON" name="SETTLEMENT_COM_REVIEWED_ON" class="form-control" /></div>
                    <div class="col-md-3"><label>RISK</label><input id="upd_RISK" name="RISK" class="form-control" /></div>
                    <div class="col-md-3"><label>ANNEX</label><input id="upd_ANNEX" name="ANNEX" class="form-control" /></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="submitUpdate();">Update</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>